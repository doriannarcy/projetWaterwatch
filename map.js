const data = {
    "watcher_watch": [
        {
            "id": "252",
            "utilisateur": "blandine",
            "nom": "bidule",
            "identifiant": "essai blandine",
            "datetime": "2022-05-12 13:50:57",
            "gps_latitude": "48.207",
            "gps_longitude": "5.94",
            "temperature_moy": "14",
            "ph_moy": "5",
            "ph_bandelette": "6",
            "ph_interpretation": null,
            "ph_moy_mV": "3000",
            "conductivite_moy": "500",
            "conductivite_moy_mV": "4000",
            "turbidite_moy_NTU": "200",
            "turbidite_moy_mV": "2000",
            "turbidite_interpretation": null,
            "profondeur": "20",
            "debit_interpretation": "xx",
            "concentration_nitrate": "30",
            "concentration_nitrite": "3",
            "interpretation_nitrate": "132.81",
            "interpretation_nitrite": "9.84",
            "etat_mesure": "xx",
            "observations": ""
        },
        {
            "id": "253",
            "utilisateur": "blandine",
            "nom": "bidule",
            "identifiant": "essai blandine 2",
            "datetime": "2022-05-12 13:51:18",
            "gps_latitude": "48.207",
            "gps_longitude": "5.94",
            "temperature_moy": "14",
            "ph_moy": "5",
            "ph_bandelette": "6",
            "ph_interpretation": null,
            "ph_moy_mV": "3000",
            "conductivite_moy": "500",
            "conductivite_moy_mV": "4000",
            "turbidite_moy_NTU": "200",
            "turbidite_moy_mV": "2000",
            "turbidite_interpretation": null,
            "profondeur": "20",
            "debit_interpretation": "xx",
            "concentration_nitrate": "30",
            "concentration_nitrite": "3",
            "interpretation_nitrate": "132.81",
            "interpretation_nitrite": "9.84",
            "etat_mesure": "xx",
            "observations": ""
        },
        {
            "id": "254",
            "utilisateur": "blandine",
            "nom": "bidule",
            "identifiant": "essai blandine 3",
            "datetime": "2022-05-12 13:53:09",
            "gps_latitude": "45.207",
            "gps_longitude": "7.94",
            "temperature_moy": "14",
            "ph_moy": "5",
            "ph_bandelette": "6",
            "ph_interpretation": null,
            "ph_moy_mV": "3000",
            "conductivite_moy": "500",
            "conductivite_moy_mV": "4000",
            "turbidite_moy_NTU": "200",
            "turbidite_moy_mV": "2000",
            "turbidite_interpretation": null,
            "profondeur": "20",
            "debit_interpretation": "xx",
            "concentration_nitrate": "30",
            "concentration_nitrite": "3",
            "interpretation_nitrate": "132.81",
            "interpretation_nitrite": "9.84",
            "etat_mesure": "xx",
            "observations": ""
        },
        {
            "id": "260",
            "utilisateur": "StÃ©phane",
            "nom": "Ruisseau 1",
            "identifiant": "ID 1_1",
            "datetime": "2022-06-20 13:43:52",
            "gps_latitude": "47.4",
            "gps_longitude": "2.2635",
            "temperature_moy": "6",
            "ph_moy": "6",
            "ph_bandelette": "6",
            "ph_interpretation": null,
            "ph_moy_mV": "6",
            "conductivite_moy": "6",
            "conductivite_moy_mV": "6",
            "turbidite_moy_NTU": "6",
            "turbidite_moy_mV": "6",
            "turbidite_interpretation": null,
            "profondeur": "6",
            "debit_interpretation": "xxxxx",
            "concentration_nitrate": "6",
            "concentration_nitrite": "3",
            "interpretation_nitrate": "26.562",
            "interpretation_nitrite": "9.84",
            "etat_mesure": "xxxxx",
            "observations": "xxxxx"
        },
        {
            "id": "261",
            "utilisateur": "StÃ©phane",
            "nom": "Ruisseau 1",
            "identifiant": "ID 1_2",
            "datetime": "2022-06-20 13:45:42",
            "gps_latitude": "47.8",
            "gps_longitude": "2.2635",
            "temperature_moy": "6",
            "ph_moy": "6",
            "ph_bandelette": "6",
            "ph_interpretation": null,
            "ph_moy_mV": "6",
            "conductivite_moy": "6",
            "conductivite_moy_mV": "-1000",
            "turbidite_moy_NTU": "6",
            "turbidite_moy_mV": "6",
            "turbidite_interpretation": null,
            "profondeur": "6",
            "debit_interpretation": "xxxxx",
            "concentration_nitrate": "6",
            "concentration_nitrite": "3",
            "interpretation_nitrate": "26.562",
            "interpretation_nitrite": "9.84",
            "etat_mesure": "xxxxx",
            "observations": "xxxxx"
        },
        {
            "id": "262",
            "utilisateur": "StÃ©phane",
            "nom": "Ruisseau 1",
            "identifiant": "ID 1_3",
            "datetime": "2022-06-20 13:48:04",
            "gps_latitude": "47.8",
            "gps_longitude": "2.2635",
            "temperature_moy": "32",
            "ph_moy": "6",
            "ph_bandelette": "12",
            "ph_interpretation": null,
            "ph_moy_mV": "6",
            "conductivite_moy": "6",
            "conductivite_moy_mV": "-100000",
            "turbidite_moy_NTU": "6",
            "turbidite_moy_mV": "6",
            "turbidite_interpretation": null,
            "profondeur": "6",
            "debit_interpretation": "xxxxx",
            "concentration_nitrate": "48",
            "concentration_nitrite": "3",
            "interpretation_nitrate": "212.496",
            "interpretation_nitrite": "9.84",
            "etat_mesure": "xxxxx",
            "observations": "xxxxx"
        },
        {
            "id": "277",
            "utilisateur": "Stéphane",
            "nom": "Ruisseau 1",
            "identifiant": "ID_SR_1",
            "datetime": "2022-06-28 17:22:32",
            "gps_latitude": "47.8",
            "gps_longitude": "2.3",
            "temperature_moy": "7",
            "ph_moy": "7",
            "ph_bandelette": "7",
            "ph_interpretation": null,
            "ph_moy_mV": "7",
            "conductivite_moy": "7",
            "conductivite_moy_mV": "7",
            "turbidite_moy_NTU": "7",
            "turbidite_moy_mV": "7",
            "turbidite_interpretation": null,
            "profondeur": "7",
            "debit_interpretation": "7",
            "concentration_nitrate": "7",
            "concentration_nitrite": "3",
            "interpretation_nitrate": "30.989",
            "interpretation_nitrite": "9.84",
            "etat_mesure": "7",
            "observations": "7"
        },
        {
            "id": "279",
            "utilisateur": "Stéphane",
            "nom": "Ruisseau 1",
            "identifiant": "ID_SR_2",
            "datetime": "2022-06-28 17:28:15",
            "gps_latitude": "47.8",
            "gps_longitude": "2.5",
            "temperature_moy": "7",
            "ph_moy": "7",
            "ph_bandelette": "7",
            "ph_interpretation": null,
            "ph_moy_mV": "7",
            "conductivite_moy": "7",
            "conductivite_moy_mV": "7",
            "turbidite_moy_NTU": "7",
            "turbidite_moy_mV": "7",
            "turbidite_interpretation": null,
            "profondeur": "7",
            "debit_interpretation": "7",
            "concentration_nitrate": "7",
            "concentration_nitrite": "3",
            "interpretation_nitrate": "30.989",
            "interpretation_nitrite": "9.84",
            "etat_mesure": "7",
            "observations": "7"
        },
        {
            "id": "282",
            "utilisateur": "Stéphane",
            "nom": "Ruisseau 2",
            "identifiant": "ID_SR_3",
            "datetime": "2022-06-30 15:37:52",
            "gps_latitude": "44",
            "gps_longitude": "2",
            "temperature_moy": "7",
            "ph_moy": "7",
            "ph_bandelette": "7",
            "ph_interpretation": null,
            "ph_moy_mV": "7",
            "conductivite_moy": "7",
            "conductivite_moy_mV": "7",
            "turbidite_moy_NTU": "7",
            "turbidite_moy_mV": "7",
            "turbidite_interpretation": null,
            "profondeur": "7",
            "debit_interpretation": "7",
            "concentration_nitrate": "7",
            "concentration_nitrite": "3",
            "interpretation_nitrate": "30.989",
            "interpretation_nitrite": "9.84",
            "etat_mesure": "7",
            "observations": "7"
        },
        {
            "id": "283",
            "utilisateur": "test",
            "nom": "test",
            "identifiant": "tesst",
            "datetime": "2022-07-16 14:56:06",
            "gps_latitude": "44",
            "gps_longitude": "2",
            "temperature_moy": "5",
            "ph_moy": "5",
            "ph_bandelette": "5",
            "ph_interpretation": null,
            "ph_moy_mV": "5",
            "conductivite_moy": "5",
            "conductivite_moy_mV": "5",
            "turbidite_moy_NTU": "5",
            "turbidite_moy_mV": "5",
            "turbidite_interpretation": null,
            "profondeur": "5",
            "debit_interpretation": "5",
            "concentration_nitrate": "5",
            "concentration_nitrite": "5",
            "interpretation_nitrate": "5",
            "interpretation_nitrite": "5",
            "etat_mesure": "5",
            "observations": "5"
        }
    ]
};


const map = L.map('map').setView([47, 5], 5);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '© OpenStreetMap'
}).addTo(map);

const addMarker = (lat, lng, jsonData, markersCluster) => 
{
    let markerText = "";
    for (let key of Object.keys(jsonData))
    {
        markerText += "<b>" + key + "</b>" + " : " + jsonData[key] + "<br>";
    }
    let marker = L.marker([lat, lng]);
    marker.bindPopup(markerText);
    markersCluster.addLayer(marker);
}

const addMarkers = (data) =>
{
    const markersCluster = new L.MarkerClusterGroup();
    for (const jsonData of data)
    {
        const lat = jsonData["gps_latitude"];
        const lng = jsonData["gps_longitude"];
        addMarker(lat, lng, jsonData, markersCluster)
    }
    map.addLayer(markersCluster);
}

addMarkers(data["watcher_watch"]);

// let marker = L.marker([51.5, -0.09]).addTo(map);

// let circle = L.circle([51.508, -0.11], {
//     color: "red",
//     fillColor: "#f03",
//     fillOpacity: 0.5,
//     radius: 500
// }).addTo(map);

// let polygon = L.polygon([
//     [51.509, -0.08],
//     [51.503, -0.06],
//     [51.51, -0.047]],
//     {
//         color: "red",
//         fillColor: "#f03",
//         fillOpacity: 0.5
//     }
// ).addTo(map);

// marker.bindPopup("<b>Hi i'm a popup</b><br>Nice popup").openPopup();
// circle.bindPopup("I'm a circle");
// polygon.bindPopup("I'm a triangle");

// let popup = L.popup()
//     .setLatLng([51.513, -0.09])
//     .setContent("I am a standalone popup.")
//     .openOn(map);

// const onMapClick = (e) =>
// {
//     let popup = L.popup();
//     popup
//         .setLatLng(e.latlng)
//         .setContent("You clicked at " + e.latlng.toString())
//         .openOn(map);
// }

// map.on("click", onMapClick);